name: CI

on:
  pull_request:
  push:
    branches: [main]

jobs:
  test-minimal:
    name: "Test: just install rv"
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Set up rv
        uses: ./

      - name: Verify rv installed
        run: rv --version

  test-ruby:
    name: "Test: install rv + Ruby"
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Set up rv with Ruby
        uses: ./
        with:
          ruby-version: 'latest'

      - name: Verify Ruby
        run: ruby --version

  test-gems-clean-install:
    name: "Test: install rv + Ruby + gems"
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Set up rv with bundler cache
        uses: ./
        with:
          ruby-version: 'latest'
          gems-clean-install: true
          working-directory: .github/workflows

      - name: Verify Ruby
        run: ruby --version

      - name: Verify gems installed
        run: rv ruby run -- -rbundler/setup -e "require 'rack'; puts Rack::VERSION"
        working-directory: .github/workflows
